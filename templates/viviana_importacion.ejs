<%# CONFIG: {
  "displayName": "VIVIANA - Importación (USD)",
  "description": "Orden de compra internacional sin IGV para Servicios Generales Viviana",
  "empresa": "viviana",
  "fields": [
    {"name": "numero_oc", "label": "Número de OC", "type": "text", "required": true, "placeholder": "000601"},
    {"name": "fecha", "label": "Fecha", "type": "date", "required": true},
    {"name": "obra", "label": "Obra", "type": "textarea", "required": true, "rows": 3},

    {"name": "proveedor_razon_social", "label": "Razón Social del Proveedor", "type": "text", "required": true},
    {"name": "proveedor_direccion", "label": "Dirección del Proveedor", "type": "text", "required": true},
    {"name": "cotizacion", "label": "N° de Cotización", "type": "text", "required": true},
    {"name": "proveedor_cuenta_corriente", "label": "Cuenta Corriente Internacional", "type": "textarea", "required": true, "rows": 2},
    {"name": "proveedor_contacto", "label": "Contacto", "type": "text", "required": true},
    {"name": "proveedor_telefono", "label": "Teléfono", "type": "text", "required": true},
    {"name": "proveedor_correo", "label": "Correo Electrónico", "type": "email", "required": true},

    {"name": "condiciones_pago", "label": "Condiciones de Pago", "type": "select", "required": true, "options": ["CONTADO", "CREDITO A 30 DIAS", "CREDITO A 60 DIAS", "CREDITO A 90 DIAS"]},
    {"name": "lugar_entrega", "label": "Lugar de Entrega", "type": "text", "required": true},

    {"name": "items", "label": "Items de la Orden", "type": "array", "required": true, "itemLabel": "Item", "fields": [
      {"name": "cantidad", "label": "Cantidad", "type": "number", "required": true, "step": "0.01"},
      {"name": "unidad", "label": "Unidad", "type": "text", "required": true, "placeholder": "UND, GLB, etc."},
      {"name": "descripcion", "label": "Descripción", "type": "textarea", "required": true, "rows": 2},
      {"name": "precio_unitario", "label": "Precio Unitario (USD)", "type": "number", "required": true, "step": "0.01"}
    ]},

    {"name": "contacto_envio_nombre", "label": "Nombre y Apellidos (Contacto para Envío)", "type": "text", "required": true},
    {"name": "contacto_envio_dni", "label": "DNI", "type": "text", "required": true},
    {"name": "contacto_envio_telefono", "label": "Teléfono", "type": "text", "required": true}
  ]
} %>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>OC <%= numero_oc %> - Servicios Generales Viviana</title>
    <style>
        @page {
            margin: 10mm;
            size: A4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 10px;
            line-height: 1.3;
            color: #000;
            background: #fff;
            position: relative;
            min-height: 100vh;
            padding-bottom: 50px;
        }

        .header {
            display: table;
            width: 100%;
            border: 2px solid #000;
            margin-bottom: 8px;
        }

        .header-left {
            display: table-cell;
            width: 60%;
            padding: 8px 12px;
            vertical-align: middle;
            border-right: 2px solid #000;
        }

        .company-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-right {
            display: table-cell;
            width: 40%;
            padding: 12px;
            text-align: center;
            vertical-align: middle;
        }

        .company-logo-img {
            max-width: 85px;
            max-height: 85px;
            height: auto;
            display: block;
        }

        .company-name {
            font-size: 14px;
            font-weight: bold;
            letter-spacing: -0.2px;
            line-height: 1.3;
        }

        .oc-number {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .fecha {
            font-size: 10px;
        }

        .obra-section {
            border: 2px solid #000;
            padding: 6px 8px;
            margin-bottom: 8px;
        }

        .obra-label {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 9px;
        }

        .obra-content {
            font-size: 9px;
            line-height: 1.4;
        }

        .info-table {
            width: 100%;
            border: 2px solid #000;
            border-collapse: collapse;
            margin-bottom: 8px;
        }

        .info-table td {
            border: 1px solid #000;
            padding: 4px 6px;
            font-size: 9px;
        }

        .info-label {
            font-weight: bold;
            width: 28%;
            background-color: #f5f5f5;
        }

        .two-column {
            display: table;
            width: 100%;
            margin-bottom: 10px;
        }

        .two-column > div {
            display: table-cell;
            width: 50%;
        }

        .box {
            border: 2px solid #000;
            padding: 8px;
            margin-right: 5px;
        }

        .box-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .items-table {
            width: 100%;
            border: 2px solid #000;
            border-collapse: collapse;
            margin-bottom: 8px;
        }

        .items-table th {
            background-color: #f5f5f5;
            border: 1px solid #000;
            padding: 5px 4px;
            text-align: center;
            font-weight: bold;
            font-size: 9px;
            line-height: 1.2;
        }

        .items-table td {
            border: 1px solid #000;
            padding: 4px;
            font-size: 9px;
            vertical-align: middle;
        }

        .items-table td.center {
            text-align: center;
        }

        .items-table td.right {
            text-align: right;
        }

        .totals {
            margin-left: 62%;
            margin-bottom: 8px;
        }

        .totals table {
            width: 100%;
            border-collapse: collapse;
        }

        .totals td {
            padding: 2px 6px;
            text-align: right;
            font-size: 9px;
        }

        .totals .label {
            font-weight: bold;
            text-align: right;
        }

        .totals .total-final {
            border-top: 2px solid #000;
            font-weight: bold;
            font-size: 10px;
            padding-top: 3px;
        }

        .data-section {
            border: 2px solid #000;
            padding: 6px 8px;
            margin-bottom: 8px;
        }

        .section-title {
            font-weight: bold;
            text-align: center;
            background-color: #f5f5f5;
            padding: 4px;
            margin: -6px -8px 6px -8px;
            border-bottom: 2px solid #000;
            font-size: 9px;
        }

        .data-row {
            margin-bottom: 2px;
            font-size: 9px;
        }

        .footer {
            text-align: center;
            font-size: 8px;
            padding-top: 8px;
            border-top: 1px solid #999;
            line-height: 1.4;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <div class="company-header">
                <% if (logoViviana) { %>
                    <img src="<%= logoViviana %>" alt="Servicios Generales Viviana" class="company-logo-img">
                <% } %>
                <div class="company-name">SERVICIOS GENERALES<br>"VIVIANA" E.I.R.L.</div>
            </div>
        </div>
        <div class="header-right">
            <div class="oc-number">ORDEN DE COMPRA Nº <%= numero_oc %></div>
            <div class="fecha">FECHA: <%= moment(fecha).format('DD [de] MMMM [de] YYYY') %></div>
        </div>
    </div>

    <!-- Obra -->
    <div class="obra-section">
        <div class="obra-label">OBRA:</div>
        <div class="obra-content"><%= obra %></div>
    </div>

    <!-- Información del Proveedor -->
    <table class="info-table">
        <tr>
            <td class="info-label">SEÑORES</td>
            <td><%= proveedor_razon_social %></td>
        </tr>
        <tr>
            <td class="info-label">DIRECCIÓN</td>
            <td><%= proveedor_direccion %></td>
        </tr>
        <tr>
            <td class="info-label">COTIZACIÓN N°</td>
            <td><%= cotizacion %></td>
        </tr>
        <tr>
            <td class="info-label">CUENTA CORRIENTE</td>
            <td><%= proveedor_cuenta_corriente %></td>
        </tr>
        <tr>
            <td class="info-label">CONTACTO</td>
            <td><%= proveedor_contacto %></td>
        </tr>
        <tr>
            <td class="info-label">TELÉFONOS</td>
            <td><%= proveedor_telefono %></td>
        </tr>
        <tr>
            <td class="info-label">CORREO ELECT.</td>
            <td><%= proveedor_correo %></td>
        </tr>
    </table>

    <!-- Condiciones y Lugar de Entrega -->
    <div class="two-column">
        <div>
            <div class="box">
                <div class="box-title">CONDICIONES DE PAGO</div>
                <div><%= condiciones_pago %></div>
            </div>
        </div>
        <div>
            <div class="box">
                <div class="box-title">LUGAR DE ENTREGA</div>
                <div><%= lugar_entrega %></div>
            </div>
        </div>
    </div>

    <!-- Tabla de Items -->
    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 5%;">ITEM</th>
                <th style="width: 10%;">CANTIDAD</th>
                <th style="width: 8%;">UND</th>
                <th style="width: 50%;">DESCRIPCIÓN</th>
                <th style="width: 13%;">P.UNITARIO (USD)</th>
                <th style="width: 14%;">IMPORTE (USD)</th>
            </tr>
        </thead>
        <tbody>
            <%
            let total = 0;
            items.forEach((item, index) => {
                const importe = parseFloat(item.cantidad) * parseFloat(item.precio_unitario);
                total += importe;
            %>
            <tr>
                <td class="center"><%= String(index + 1).padStart(2, '0') %></td>
                <td class="center"><%= formatNumber(item.cantidad, 2) %></td>
                <td class="center"><%= item.unidad %></td>
                <td><%= item.descripcion %></td>
                <td class="right">USD <%= formatNumber(item.precio_unitario, 2) %></td>
                <td class="right">USD <%= formatNumber(importe, 2) %></td>
            </tr>
            <% }); %>
        </tbody>
    </table>

    <!-- Total (sin IGV para importación) -->
    <div class="totals">
        <table>
            <tr class="total-final">
                <td class="label">TOTAL</td>
                <td>USD</td>
                <td class="right"><%= formatNumber(total, 2) %></td>
            </tr>
        </table>
    </div>

    <!-- Datos de Facturación -->
    <div class="data-section">
        <div class="section-title">DATOS DE FACTURACIÓN</div>
        <div class="data-row"><strong>RAZÓN SOCIAL:</strong> SERVICIOS GENERALES VIVIANA EIRL</div>
        <div class="data-row"><strong>RUC:</strong> 20483851171</div>
        <div class="data-row"><strong>DIRECCIÓN:</strong> Urb. Jardín 2 Etapa N° D-2 Int. 13 - Sullana - Piura</div>
    </div>

    <!-- Datos del Contacto -->
    <div class="data-section">
        <div class="section-title">DATOS DEL CONTACTO</div>
        <div class="data-row"><strong>NOMBRES Y APELLIDOS:</strong> <%= contacto_envio_nombre %></div>
        <div class="data-row"><strong>DNI:</strong> <%= contacto_envio_dni %></div>
        <div class="data-row"><strong>TELÉFONO:</strong> <%= contacto_envio_telefono %></div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <strong>Urb. Jardín 2 Etapa N° D-2 Int. 13 - Sullana - Piura</strong><br>
        Teléfono: 073 - 504710 - 958194183
    </div>
</body>
</html>